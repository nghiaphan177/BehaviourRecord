@{
    ViewData["Title"] = "Trang chủ";
}
@section styles{
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.2.0/css/datepicker.min.css" rel="stylesheet">
}
<div class="row">
    <div class="col-sm-12">
        <div class="page-title-box">
            <h4 class="page-title">@ViewData["Title"]</h4>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-xl-4 col-md-6">
        <div class="card mini-stat bg-primary">
            <div class="card-body mini-stat-img">
                <div class="mini-stat-icon">
                    <i class="mdi mdi-human-male float-right"></i>
                </div>
                <div class="text-white">
                    <h6 class="text-uppercase mb-3 font-size-16">Số lượng giáo viên</h6>
                    <h2 class="mb-4" id="teacount"></h2>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-4 col-md-6">
        <div class="card mini-stat bg-primary">
            <div class="card-body mini-stat-img">
                <div class="mini-stat-icon">
                    <i class="mdi mdi-human-male-female float-right"></i>
                </div>
                <div class="text-white">
                    <h6 class="text-uppercase mb-3 font-size-16">Số lượng học sinh</h6>
                    <h2 class="mb-4" id="stucount"></h2>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title mb-4">Số tài khoản theo vai trò</h4>
                <div class="row text-center mt-4">
                    <div class="col-sm-4">
                    </div>
                    <div class="col-sm-4">
                        <h5 class="mb-0 font-size-20" id="sumacc"></h5>
                        <p class="text-muted">Tổng số tài khoản</p>
                    </div>
                    <div class="col-sm-4">
                    </div>
                </div>
                <canvas id="donut" height="100"></canvas>

            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title mb-4">Số tài khoản đã xác nhận</h4>
                <div class="row text-center mt-4">
                    <div class="col-sm-4">
                    </div>
                    <div class="col-sm-4">
                        <h5 class="mb-0 font-size-20" id="sumaccpie"></h5>
                        <p class="text-muted">Tổng số tài khoản</p>
                    </div>
                    <div class="col-sm-4">
                    </div>
                </div>
                <canvas id="pie" height="100"></canvas>

            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">

                <h4 class="card-title mb-4">Số lượng tài khoản mới theo năm</h4>
                <div class="row text-right mt-4">
                    <div class="col-sm-12">
                        Năm: <input readonly type="text" name="datepicker" id="datepicker" style="width:45px;" />
                    </div>
                </div>
                @*<div class="row text-center mt-4">
                        <div class="col-sm-4">
                            <h5 class="mb-0 font-size-20">2541</h5>
                            <p class="text-muted">Activated</p>
                        </div>
                        <div class="col-sm-4">
                            <h5 class="mb-0 font-size-20">84845</h5>
                            <p class="text-muted">Pending</p>
                        </div>
                        <div class="col-sm-4">
                            <h5 class="mb-0 font-size-20">12001</h5>
                            <p class="text-muted">Deactivated</p>
                        </div>
                    </div>*@

                <canvas id="bar" height="100"></canvas>

            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">

                <h4 class="card-title mb-4">Số lượng tài khoản mới theo tháng</h4>
                <div class="row text-right mt-4">
                    <div class="col-sm-12">
                        Tháng: <input readonly type="text" name="monthpicker" id="monthpicker"style="width:65px;" />
                    </div>
                </div>
                @*<div class="row text-center mt-4">
                        <div class="col-sm-4">
                            <h5 class="mb-0 font-size-20">2541</h5>
                            <p class="text-muted">Activated</p>
                        </div>
                        <div class="col-sm-4">
                            <h5 class="mb-0 font-size-20">84845</h5>
                            <p class="text-muted">Pending</p>
                        </div>
                        <div class="col-sm-4">
                            <h5 class="mb-0 font-size-20">12001</h5>
                            <p class="text-muted">Deactivated</p>
                        </div>
                    </div>*@

                <canvas id="baraccountmonth" height="100"></canvas>

            </div>
        </div>
    </div>
</div>
@section scripts {
    <script src="~/lib/morris.js/morris.min.js"></script>
    <script src="~/lib/raphael/raphael.min.js"></script>
    <script src="~/lib/chart.js/Chart.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.2.0/js/bootstrap-datepicker.min.js"></script>
    <script>
        function LoadChart(year) {
            var obj = {};
            $.ajax({
                type: "GET",
                url: "https://bmsapis.azurewebsites.net/api/AdBd/GetCountAllAccountRegisterOfYear?year=" + year,
                data: JSON.stringify(obj),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    var chart = document.getElementById('bar').getContext('2d');                    
                    var data1 = response["result"].map(a => a.item2)
                    var mychar = new Chart(chart, {
                        type: 'bar',
                        data: {
                            labels: [
                                "Tháng 1",
                                "Tháng 2",
                                "Tháng 3",
                                "Tháng 4",
                                "Tháng 5",
                                "Tháng 6",
                                "Tháng 7",
                                "Tháng 8",
                                "Tháng 9",
                                "Tháng 10",
                                "Tháng 11",
                                "Tháng 12",
                            ],
                            datasets: [
                                {
                                    label: "Tài khoản đăng ký",
                                    backgroundColor: "#28bbe3",
                                    borderColor: "#28bbe3",
                                    borderWidth: 1,
                                    hoverBackgroundColor: "#28bbe3",
                                    hoverBorderColor: "#28bbe3",
                                    data: data1,
                                },
                            ],
                        }
                    });
                }
            });
        }
        function LoadChartMonth(month, year) {
            var obj = {};
            $.ajax({
                type: "GET",
                url: "https://bmsapis.azurewebsites.net/api/AdBd//GetCountAllAccountRegisterOfMonth?month=" + month + " &year=" + year,
                data: JSON.stringify(obj),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    var chart = document.getElementById('baraccountmonth').getContext('2d');
                    var datalabel = response["result"].map(a => ("ngày " + a.item1))
                    var data1 = response["result"].map(a => a.item2)
                    var mychar = new Chart(chart, {
                        type: 'bar',
                        data: {
                            labels: datalabel,
                            datasets: [
                                {
                                    label: "Tài khoản đăng ký",
                                    backgroundColor: "#28bbe3",
                                    borderColor: "#28bbe3",
                                    borderWidth: 1,
                                    hoverBackgroundColor: "#28bbe3",
                                    hoverBorderColor: "#28bbe3",
                                    data: data1,
                                },
                            ],
                        }
                    });
                }
            });
        }
        function LoadDonutTeacherStudent() {
            var obj = {};
            $.ajax({
                type: "GET",
                url: "https://bmsapis.azurewebsites.net/api/AdBd/GetAllStudentAndTeacherAndAllAccount",
                data: JSON.stringify(obj),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    var chart = document.getElementById('donut').getContext('2d');
                    $("#teacount").text(response["result"]['item2']);
                    $("#stucount").text(response["result"]['item1']);
                    $("#sumacc").text(response["result"]['item3']);
                    var data1 = [response["result"]['item1'], response["result"]['item2']];
                    var mychar = new Chart(chart, {
                        type: 'doughnut',
                        data: {
                            labels: ['Học sinh', 'Giáo viên'],
                            datasets: [
                                {
                                    label: "Tài khoản đăng ký",
                                    data: data1,
                                    backgroundColor: [
                                        'rgb(255, 99, 132)',
                                        'rgb(54, 162, 235)',
                                    ],
                                },
                            ],
                        }
                    });
                }
            });
        }
        function LoadPieAccount() {
            var obj = {};
            $.ajax({
                type: "GET",
                url: "https://bmsapis.azurewebsites.net/api/AdBd/GetAllAccountNotVerifyMail",
                data: JSON.stringify(obj),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    var chart = document.getElementById('pie').getContext('2d');
                    $("#sumaccpie").text(response["result"]['item2']);
                    var data1 = [(response["result"]['item2'] - response["result"]['item1']), response["result"]['item1']];
                    var mychar = new Chart(chart, {
                        type: 'pie',
                        data: {
                            labels: ['Đã xác nhận', 'Chưa xác nhận'],
                            datasets: [
                                {
                                    data: data1,
                                    backgroundColor: [
                                        'rgb(255, 99, 132)',
                                        'rgb(54, 162, 235)',
                                    ],
                                },
                            ],
                        }
                    });
                }
            });
        }
        $(document).ready(function () {
            var d = new Date();
            var output = d.getFullYear()
            LoadChartMonth(d.getMonth() + 1, d.getFullYear());
            LoadChart(output);
            LoadDonutTeacherStudent();
            LoadPieAccount();
            $("#datepicker").val(output);
            $("#monthpicker").val(d.getMonth() + 1 + "-" + d.getFullYear());
            $("#monthpicker").datepicker({
                language: 'vi',
                locale: 'vi',
                format: "mm-yyyy",
                startView: "months",
                minViewMode: "months"
            }).on("changeDate", function () {
                // get date value
                var d = $("#monthpicker").datepicker("getDate");
                LoadChartMonth(d.getMonth() + 1, d.getFullYear());
            });;
            $("#datepicker").datepicker({
                language: 'vi',
                locale: 'vi',
                format: "yyyy",
                viewMode: "years",
                minViewMode: "years",
                updateViewDate: true,
                autoclose: true //to close picker once year is selected
            }).on("changeDate", function () {
                // get date value
                var year = $("#datepicker").datepicker("getDate").getFullYear();
                LoadChart(year);
            });
        });
    </script>
}
